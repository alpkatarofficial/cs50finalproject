<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fuel Type Distribution</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="text-center text-success mb-4">Fuel Type Distribution by State(s) or Region(s)</h2>

    <form method="POST">
        <div class="row">
            <!-- Input Controls -->
            <div class="col-md-4">
                <div class="mb-3">
                    <label for="states" class="form-label">Select State(s)</label>
                    <select multiple name="states" class="form-select">
                        {% for state in states %}
                            <option value="{{ state[0] }}">{{ state[0] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="regions" class="form-label">Select Region(s)</label>
                    <select multiple name="regions" class="form-select">
                        {% for region in regions %}
                            <option value="{{ region[0] }}">{{ region[0] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-success">Generate Chart</button>
                </div>
            </div>

            <!-- Pie Chart Output -->
            <div class="col-md-8">
                <div id="pieChart" style="height: 500px;"></div>

                {% if sql_query %}
                    <div class="mt-4 p-3 bg-white border rounded shadow-sm">
                        <h6 class="text-muted">SQL Query Used:</h6>
                        <pre class="bg-light p-3 rounded border text-dark small" style="font-family: 'Poppins', monospace;">{{ sql_query }}</pre>
                    </div>
                {% endif %}
            </div>
        </div>
    </form>
</div>

<!-- Chart Rendering -->
<script>
    const data = {{ chart_data | tojson }};
    if (data.length > 0) {
        const labels = data.map(d => d[0]);
        const values = data.map(d => d[1]);

        const plotData = [{
            labels: labels,
            values: values,
            type: 'pie',
            textinfo: 'label+percent',
            hoverinfo: 'label+value+percent',
            marker: {
                line: { color: '#fff', width: 2 }
            }
        }];

        const layout = {
            margin: { t: 30, b: 0, l: 0, r: 0 },
            legend: { orientation: "h", y: -0.2 }
        };

        Plotly.newPlot('pieChart', plotData, layout);
    }
</script>
</body>
</html>
