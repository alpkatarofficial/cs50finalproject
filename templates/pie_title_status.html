<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title Status Distribution</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="text-center text-success mb-4">Title Status % by State</h2>
    <div class="row">
        <!-- Form Area -->
        <div class="col-md-4">
            <form method="POST" action="/piechart/title_status">
                <div class="mb-3">
                    <label for="state" class="form-label">Select State</label>
                    <select class="form-select" name="state" id="state">
                        <option value="">All States</option>
                        {% for state in states %}
                            <option value="{{ state[0] }}">{{ state[0] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Generate Pie Chart</button>
            </form>
            {% if sql_query %}
                <div class="mt-4 bg-white p-3 border rounded shadow-sm">
                    <h6 class="text-muted">SQL Query:</h6>
                    <pre class="bg-light p-2 text-dark" style="font-family: 'Courier New', monospace;">{{ sql_query }}</pre>
                </div>
            {% endif %}
        </div>

        <!-- Chart Area -->
        <div class="col-md-8">
            <div id="pieChart" style="height: 500px;"></div>
        </div>
    </div>
</div>

{% if chart_data %}
<script>
    const chartData = {
        labels: {{ chart_data | map(attribute=0) | list | tojson }},
        values: {{ chart_data | map(attribute=1) | list | tojson }},
        type: 'pie',
        textinfo: 'label+percent',
        insidetextorientation: 'radial'
    };

    const layout = {
        title: 'Title Status Distribution',
        height: 500,
        margin: { t: 50, l: 20, r: 20, b: 20 }
    };

    Plotly.newPlot('pieChart', [chartData], layout);
</script>
{% endif %}
</body>
</html>
