<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Condition Pie Chart</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="text-center text-success mb-4">Condition Distribution</h2>

    <div class="row">
        <!-- Left Column: Filters -->
        <div class="col-md-4">
            <form method="POST" class="row g-3">
                <div class="col-12">
                    <label for="state" class="form-label">Select State</label>
                    <select name="state" class="form-select">
                        <option value="">All States</option>
                        {% for s in states %}
                            <option value="{{ s[0] }}">{{ s[0] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-12">
                    <label for="type" class="form-label">Select Vehicle Type</label>
                    <select name="type" class="form-select">
                        <option value="">All Types</option>
                        {% for t in types %}
                            <option value="{{ t[0] }}">{{ t[0] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-12 text-center mt-3">
                    <button type="submit" class="btn btn-success px-4">Generate Pie Chart</button>
                </div>
            </form>
        </div>

        <!-- Right Column: Pie Chart -->
        <div class="col-md-8">
            {% if chart_data %}
                <div id="pieChart" style="height: auto;"></div>



                <script>
                    const labels = {{ chart_data | map(attribute=0) | list | tojson }};
                    const values = {{ chart_data | map(attribute=1) | list | tojson }};

                    const data = [{
                        values: values,
                        labels: labels,
                        type: 'pie',
                        hole: 0.3,
                        textinfo: 'label+percent',
                        insidetextorientation: 'radial'
                    }];

                    const layout = {
                        title: 'Condition Distribution',
                        margin: { t: 40, l: 10, r: 10, b: 10 }
                    };

                    Plotly.newPlot('pieChart', data, layout);
                </script>
            {% endif %}
        </div>
    </div>
</div>
</body>
</html>
